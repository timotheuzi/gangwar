{% extends "base.html" %}

{% block content %}
<div class="fight-defeat-screen">
    <h2>üíÄ FIGHT DEFEAT üíÄ</h2>

    <div class="defeat-message">
        <h3>You've Been Defeated!</h3>
        {% if game_state.lives > 0 %}
        <p>You lost the fight and took fatal damage. You've lost a life!</p>
        <p>Lives remaining: <strong>{{ game_state.lives }}</strong></p>
        {% else %}
        <p>You lost the fight and took fatal damage. You've run out of lives!</p>
        <p><strong>GAME OVER</strong></p>
        {% endif %}
    </div>



    <div class="defeat-details">
        <h3>MUD Combat Report</h3>
        {% if fight_log %}
        <div class="combat-log">
            <div class="mud-style-header">
                <p><strong>‚öîÔ∏è COMBAT LOG - TURN BY TURN ‚öîÔ∏è</strong></p>
                <p><em>Opponent: {{ enemy_type }}{% if enemy_count > 1 %} ({{ enemy_count }} enemies){% endif %}</em></p>
            </div>
            {% for entry in fight_log %}
            <div class="combat-turn">
                <span class="turn-marker">></span>
                <span class="turn-text">{{ entry }}</span>
            </div>
            {% endfor %}
            <div class="defeat-summary">
                <p><strong>FINAL OUTCOME:</strong> Defeated by {{ enemy_type }} - {{ final_damage }} total damage taken</p>
            </div>
        </div>
        {% else %}
        <div class="combat-log">
            <div class="mud-style-header">
                <p><strong>‚öîÔ∏è COMBAT LOG - TURN BY TURN ‚öîÔ∏è</strong></p>
                <p><em>Opponent: {{ enemy_type }}{% if enemy_count > 1 %} ({{ enemy_count }} enemies){% endif %}</em></p>
            </div>
            <div class="combat-turn">
                <span class="turn-marker">></span>
                <span class="turn-text">You engaged in fierce combat with {{ enemy_type }}</span>
            </div>
            <div class="combat-turn">
                <span class="turn-marker">></span>
                <span class="turn-text">The battle raged back and forth with heavy casualties</span>
            </div>
            <div class="combat-turn">
                <span class="turn-marker">></span>
                <span class="turn-text">Despite your best efforts, you were overwhelmed</span>
            </div>
            <div class="defeat-summary">
                <p><strong>FINAL OUTCOME:</strong> Defeated by {{ enemy_type }} - {{ final_damage }} total damage taken</p>
            </div>
        </div>
        {% endif %}
        {% if game_state.lives > 0 %}
        <p>You've been revived in the city with full health, but you're one step closer to total defeat.</p>
        {% else %}
        <p>This was your final life. Your gang's reign has come to an end.</p>
        {% endif %}
    </div>



    <div class="current-stats">
        <h3>Your Current Status</h3>
        <div class="stats-grid">
            <div class="stat-item">
                <p>Health: {{ game_state.health }}/100</p>
                <p>Money: ${{ "{:,}".format(game_state.money) }}</p>
                <p>Gang Members: {{ game_state.members }}</p>
            </div>
            <div class="stat-item">
                <p>Day: {{ game_state.day }}</p>
                <p>Steps Today: {{ game_state.steps }}/{{ game_state.max_steps }}</p>
                <p>Current Score: {{ game_state.current_score }}</p>
            </div>
        </div>
    </div>

    {% if game_state.lives > 0 %}
    <div class="warning">
        <h3>Warning</h3>
        <p>If you lose all your lives, the game will be over permanently!</p>
        <p>Be more careful in future fights. Consider buying better weapons or recruiting more members.</p>
    </div>

    <div class="actions">
        <p>Review the details above and click to continue when ready.</p>
        <a href="{{ url_for('city') }}" class="btn btn-primary">Return to City</a>
    </div>
    {% else %}
    <div class="actions">
        <p>Your final defeat. Review the details above and click to continue.</p>
        <a href="{{ url_for('game_over') }}" class="btn btn-danger">View Game Over</a>
    </div>
    {% endif %}
</div>



<style>
.fight-defeat-screen {
    max-width: 800px;
    margin: 0 auto;
    padding: 20px;
    text-align: center;
}

.defeat-message {
    background: rgba(255, 0, 0, 0.1);
    border: 2px solid #ff0000;
    border-radius: 10px;
    padding: 20px;
    margin: 20px 0;
}

.defeat-details, .fight-recap, .current-stats, .warning {
    background: rgba(0, 0, 0, 0.1);
    border-radius: 10px;
    padding: 15px;
    margin: 15px 0;
}

.stats-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px;
    margin-top: 10px;
}

.stat-item {
    background: rgba(255, 255, 255, 0.1);
    padding: 10px;
    border-radius: 5px;
}

.actions {
    margin-top: 30px;
}

#countdown {
    font-size: 24px;
    font-weight: bold;
    color: #ff0000;
}
</style>
{% endblock %}
