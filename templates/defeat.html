{% extends "base.html" %}

{% block content %}
<div class="defeat-screen">
    <h2>💀 DEFEAT 💀</h2>
    
    <div class="defeat-message">
        <h3>You've Lost the Gang War!</h3>
        <p>The Squidies  were too strong for your gang. Your forces have been defeated.</p>
        <p>Your gang, <strong>{{ game_state.player_name }}</strong>, has been wiped out.</p>
    </div>
    
    <div class="defeat-stats">
        <h3>Final Statistics:</h3>
        <div class="stats-grid">
            <div class="stat-item">
                <h4>What You Had</h4>
                <p>Gang Members: {{ game_state.members }}</p>
                <p>Cash: ${{ "{:,}".format(game_state.money) }}</p>
                <p>Drug Inventory: ${{ "{:,}".format(game_state.drugs.weed * game_state.drug_prices['weed'] + game_state.drugs.crack * game_state.drug_prices['crack'] + game_state.drugs.coke * game_state.drug_prices['coke'] + game_state.drugs.ice * game_state.drug_prices['ice'] + game_state.drugs.percs * game_state.drug_prices['percs'] + game_state.drugs.pixie_dust * game_state.drug_prices['pixie_dust']) }}</p>
            </div>
            
            <div class="stat-item">
                <h4>What You Fought Against</h4>
                <p>Squidies Members: {{ game_state.squidies|int }}</p>
                <p>Squidies Pistols: {{ game_state.squidies_pistols|int }}</p>
                <p>Squidies Uzis: {{ game_state.squidies_uzis|int }}</p>
                <p>Squidies Heavy Weapons: {{ game_state.squidies_grenades|int + game_state.squidies_missiles|int }} total</p>
            </div>
        </div>
    </div>
    
    <div class="defeat-analysis">
        <h3>What Went Wrong?</h3>
        <ul>
            {% if game_state.members < 15 %}
            <li>❌ Your gang was too small ({{ game_state.members }} members vs {{ game_state.squidies|int }} squidies )</li>
            {% endif %}
            {% if game_state.weapons.pistols + game_state.weapons.uzis < game_state.squidies_pistols|int + game_state.squidies_uzis|int %}
            <li>❌ You were outgunned by the squidies</li>
            {% endif %}
            {% if game_state.weapons.grenades + game_state.weapons.missiles < game_state.squidies_grenades|int + game_state.squidies_missiles|int %}
            <li>❌ You lacked heavy weapons compared to the enemy</li>
            {% endif %}
            <li>💡 Tip: Build a larger gang and stock up on heavy weapons before challenging the squidies </li>
        </ul>
    </div>
    
    <div class="defeat-epilogue">
        <h3>Epilogue</h3>
        <p>The squidies  have eliminated your gang and taken control of your territory. 
        Your name is forgotten in the criminal underworld, just another failed gang leader.</p>
        <p>The streets belong to the squidies  now. Your empire has crumbled.</p>
    </div>
    
    <div class="actions">
        <a href="{{ url_for('index') }}" class="btn btn-primary">Try Again</a>
    </div>

    <div class="chat-pvp-container">
        <div class="chat-section">
            <h4>City Chat</h4>
            <div id="chat-messages" class="chat-messages"></div>
            <div class="chat-input">
                <input type="text" id="chat-input" placeholder="Type a message..." maxlength="200">
                <button id="send-chat" class="btn btn-secondary">Send</button>
            </div>
        </div>

        <!-- Chat Users Section -->
        <div class="pvp-section">
            <h3>👥 Chat Users</h3>
            <div id="pvp-player-list" class="pvp-player-list">
                <p>Loading users...</p>
            </div>
            <div class="pvp-actions">
                <button onclick="refreshPlayerList()" class="btn btn-secondary btn-small">Refresh Users</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}
