{% extends "base.html" %}

{% block content %}
<div class="bar-screen">
    <h2>Vagabond's Pub</h2>
    <p>A seedy bar where deals are made and information flows freely.</p>
    
    <div class="bar-content">
        <div class="contact-section">
            <h3>Meet Contacts</h3>
            <p>This is where you can meet important people who can help your business.</p>
            
            {% if not game_state.flags.eric_met %}
            <div class="contact">
                <h4>Nox the Informant</h4>
                <p>Nox knows everything about the drug trade in this city. He can give you valuable information about prices and opportunities.</p>
                <p><strong>Status:</strong> Not met yet</p>
                <form action="{{ url_for('meet_contact') }}" method="post" class="contact-form">
                    <input type="hidden" name="contact" value="nox">
                    <button type="submit" class="btn btn-success btn-small">Meet Nox</button>
                </form>
            </div>
            {% else %}
            <div class="contact">
                <h4>Nox the Informant</h4>
                <p>Nox is your trusted source for street intelligence. He's sitting at the bar, nursing a drink.</p>
                <p><strong>Status:</strong> Contact established</p>
                <div class="contact-actions">
                    <a href="{{ url_for('talk_to_npc', npc_id='nox') }}" class="btn btn-primary btn-small">Talk to Nox</a>
                    <a href="{{ url_for('trade_with_npc', npc_id='nox') }}" class="btn btn-secondary btn-small">Trade</a>
                    <form method="POST" action="{{ url_for('fight_npc', npc_id='nox') }}" style="display: inline;">
                        <button type="submit" class="btn btn-danger btn-small">Fight Nox</button>
                    </form>
                </div>
            </div>
            {% endif %}

            {% if not game_state.flags.steve_met %}
            <div class="contact">
                <h4>Raze the Supplier</h4>
                <p>Raze has connections to high-quality suppliers. He can get you better deals on bulk purchases.</p>
                <p><strong>Status:</strong> Not met yet</p>
                <form action="{{ url_for('meet_contact') }}" method="post" class="contact-form">
                    <input type="hidden" name="contact" value="raze">
                    <button type="submit" class="btn btn-success btn-small">Meet Raze</button>
                </form>
            </div>
            {% else %}
            <div class="contact">
                <h4>Raze the Supplier</h4>
                <p>Raze is your go-to guy for bulk deals. He's standing by the back door, looking intimidating.</p>
                <p><strong>Status:</strong> Contact established</p>
                <div class="contact-actions">
                    <a href="{{ url_for('talk_to_npc', npc_id='raze') }}" class="btn btn-primary btn-small">Talk to Raze</a>
                    <a href="{{ url_for('trade_with_npc', npc_id='raze') }}" class="btn btn-secondary btn-small">Trade</a>
                    <a href="{{ url_for('closet') }}" class="btn btn-warning btn-small">Visit Closet</a>
                    <form method="POST" action="{{ url_for('fight_npc', npc_id='raze') }}" style="display: inline;">
                        <button type="submit" class="btn btn-danger btn-small">Fight Raze</button>
                    </form>
                </div>
            </div>
            {% endif %}
        </div>
        
        <div class="info-section">
            <h3>Street Information</h3>
            <p>Current market conditions:</p>
            <ul>
                <li>Weed market: {% if game_state.drug_prices['weed'] > 75 %}High{% else %}Low{% endif %}</li>
                <li>Crack market: {% if game_state.drug_prices['crack'] > 1500 %}Hot{% else %}Cool{% endif %}</li>
                <li>Cocaine market: {% if game_state.drug_prices['coke'] > 10000 %}Booming{% else %}Stable{% endif %}</li>
                <li>Ice market: {% if game_state.drug_prices['ice'] > 5000 %}Rising{% else %}Falling{% endif %}</li>
                <li>Percs market: {% if game_state.drug_prices['percs'] > 20000 %}Volatile{% else %}Calm{% endif %}</li>
                <li>Pixie Dust market: {% if game_state.drug_prices['pixie_dust'] > 100000 %}Explosive{% else %}Quiet{% endif %}</li>
            </ul>
        </div>
        
        <div class="tips-section">
            <h3>Street Tips</h3>
            <ul>
                <li>Always carry protection when dealing with large amounts</li>
                <li>Watch out for undercover cops</li>
                <li>Prices change daily - buy low, sell high</li>
                <li>The Squidies are getting stronger</li>
                <li>New drugs like ice, percs, and pixie dust are hitting the streets</li>
            </ul>
        </div>
    </div>
    
    <div class="actions">
        <a href="{{ url_for('npcs') }}" class="btn btn-info">Look Around</a>
        <a href="{{ url_for('city') }}" class="btn btn-primary">Back to City</a>
    </div>

    <div class="chat-pvp-container">
        <div class="chat-section">
            <h4>Bar Chat</h4>
            <div id="chat-messages" class="chat-messages"></div>
            <div class="chat-input">
                <input type="text" id="chat-input" placeholder="Type your message..." maxlength="200">
                <button id="send-chat" class="btn btn-primary btn-small">Send</button>
            </div>
        </div>

        <!-- Chat Users Section -->
        <div class="pvp-section">
            <h3>ðŸ‘¥ Chat Users</h3>
            <div id="pvp-player-list" class="pvp-player-list">
                <p>Loading users...</p>
            </div>
            <div id="player-list"></div>
            <div class="pvp-actions">
                <button onclick="refreshPlayerList()" class="btn btn-secondary btn-small">Refresh Users</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}
