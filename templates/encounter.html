{% extends "base.html" %}

{% block content %}
<div class="encounter-screen">
    <h2>Encounter!</h2>

    <div class="encounter-message">
        <p>{{ encounter_description }}</p>
    </div>

    {% if encounter_type == "squidies" %}
    <div class="encounter-info">
        <h3>Squidies Gang Encounter</h3>
        <p>The Squidies are a dangerous rival gang known for their ruthless tactics. They might try to rob you or demand protection money.</p>
    </div>
    {% elif encounter_type == "baby_momma" %}
    <div class="encounter-info">
        <h3>Baby Momma Encounter</h3>
        <p>Your ex has spotted you and is demanding child support. She won't take no for an answer and might get violent if you refuse.</p>
    </div>
    {% elif encounter_type == "discovery" %}
    <div class="encounter-info">
        <h3>Discovery Found!</h3>
        <p>You've stumbled upon something interesting that might contain valuable items. However, exploring could be dangerous - there might be traps, guards, or structural hazards.</p>
    </div>
    {% elif encounter_type == "drug_deal" %}
    <div class="encounter-info">
        <h3>Drug Deal Opportunity</h3>
        <p>A shady dealer has approached you with an offer. You can try to negotiate a better deal, accept their terms, or walk away from the transaction.</p>
    </div>
    {% endif %}

    {% if game_state %}
    <div class="current-status">
        <h3>Current Status:</h3>
        <p>Money: ${{ "{:,}".format(game_state.money) if game_state.money else "0" }}</p>
        <p>Health: {{ (10 - game_state.damage) if game_state.damage else 10 }}/10</p>
        {% if game_state.weapons %}
        <p>Weapons:
            {{ game_state.weapons.pistols if game_state.weapons.pistols else 0 }} pistols,
            {{ game_state.weapons.bullets if game_state.weapons.bullets else 0 }} bullets
        </p>
        {% endif %}
    </div>
    {% endif %}

    <div class="encounter-actions">
        {% if encounter_type == "discovery" %}
        <h3>How do you approach this discovery?</h3>
        {% elif encounter_type == "drug_deal" %}
        <h3>How do you handle this deal?</h3>
        {% else %}
        <h3>What do you do?</h3>
        {% endif %}

        <form method="POST" action="{{ url_for('handle_encounter') }}" style="display: inline;">
            <input type="hidden" name="encounter_type" value="{{ encounter_type }}">
            <input type="hidden" name="action" value="fight">
            {% if encounter_type == "discovery" %}
            <button type="submit" class="btn btn-danger">Force Entry</button>
            {% elif encounter_type == "drug_deal" %}
            <button type="submit" class="btn btn-danger">Intimidate</button>
            {% else %}
            <button type="submit" class="btn btn-danger">Fight</button>
            {% endif %}
        </form>

        <form method="POST" action="{{ url_for('handle_encounter') }}" style="display: inline;">
            <input type="hidden" name="encounter_type" value="{{ encounter_type }}">
            <input type="hidden" name="action" value="run">
            {% if encounter_type == "discovery" %}
            <button type="submit" class="btn btn-warning">Walk Away</button>
            {% elif encounter_type == "drug_deal" %}
            <button type="submit" class="btn btn-warning">Decline Deal</button>
            {% else %}
            <button type="submit" class="btn btn-warning">Run</button>
            {% endif %}
        </form>

        <form method="POST" action="{{ url_for('handle_encounter') }}" style="display: inline;">
            <input type="hidden" name="encounter_type" value="{{ encounter_type }}">
            <input type="hidden" name="action" value="sneak">
            {% if encounter_type == "discovery" %}
            <button type="submit" class="btn btn-secondary">Sneak In</button>
            {% elif encounter_type == "drug_deal" %}
            <button type="submit" class="btn btn-secondary">Negotiate</button>
            {% else %}
            <button type="submit" class="btn btn-secondary">Sneak By</button>
            {% endif %}
        </form>

        {% if encounter_type in ["squidies", "baby_momma", "discovery", "drug_deal"] %}
        <form method="POST" action="{{ url_for('handle_encounter') }}" style="display: inline;">
            <input type="hidden" name="encounter_type" value="{{ encounter_type }}">
            <input type="hidden" name="action" value="trade">
            <button type="submit" class="btn btn-info">Trade</button>
        </form>
        {% endif %}
    </div>

    <div class="actions">
        <a href="{{ url_for('city') }}" class="btn btn-primary">Back to City (Give Up)</a>
    </div>

    <div id="player-list"></div>

    <div class="chat-section">
        <h4>City Chat</h4>
        <div id="chat-messages" class="chat-messages"></div>
        <div class="chat-input">
            <input type="text" id="chat-input" placeholder="Type a message..." maxlength="200">
            <button id="send-chat" class="btn btn-secondary">Send</button>
        </div>
    </div>
</div>
{% endblock %}
