{% extends "base.html" %}

{% block content %}
<div class="npcs-screen">
    <h2>People in {{ game_state.current_location.title() }}</h2>
    <p>You look around and see the following people:</p>

    {% if npcs %}
        <div class="npcs-list">
            {% for npc in npcs %}
            <div class="npc-card">
                <h3>{{ npc.name }}</h3>
                <p class="personality">{{ npc.personality.title() }} personality</p>
                <p class="npc-status">{% if npc.is_alive %}HP: {{ npc.hp }}/{{ npc.max_hp }}{% else %}Dead{% endif %}</p>
                <div class="npc-actions">
                    <a href="{{ url_for('talk_to_npc', npc_id=npc.id) }}" class="btn btn-primary">Talk</a>
                    <a href="{{ url_for('look_at_npc', npc_id=npc.id) }}" class="btn btn-info">Look</a>
                    <a href="{{ url_for('trade_with_npc', npc_id=npc.id) }}" class="btn btn-secondary">Trade</a>
                    {% if npc.is_alive %}
                        <a href="{{ url_for('npc_interaction', npc_id=npc.id) }}" class="btn btn-danger">Fight</a>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
    {% else %}
        <p class="no-npcs">There doesn't seem to be anyone around right now.</p>
    {% endif %}

    <div class="actions">
        <a href="{{ url_for('city') }}" class="btn btn-primary">Back to City</a>
    </div>

    <div class="chat-pvp-container">
        <div class="chat-section">
            <h4>NPCs Chat</h4>
            <div id="chat-messages" class="chat-messages"></div>
            <div class="chat-input">
                <input type="text" id="chat-input" placeholder="Type your message..." maxlength="200">
                <button id="send-chat" class="btn btn-primary btn-small">Send</button>
            </div>
        </div>

        <!-- Chat Users Section -->
        <div class="pvp-section">
            <h3>ðŸ‘¥ Chat Users</h3>
            <div id="pvp-player-list" class="pvp-player-list">
                <p>Loading users...</p>
            </div>
            <div id="player-list"></div>
            <div class="pvp-actions">
                <button onclick="refreshPlayerList()" class="btn btn-secondary btn-small">Refresh Users</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}
